# Appointments Setup

This feature uses Supabase for storage and Stripe Checkout for payments.

## Environment Variables

Set these in Cloudflare Pages (or Vercel if deployed there):

- `SUPABASE_URL`
- `SUPABASE_SERVICE_KEY` (service role key)
- `SUPABASE_ANON_KEY`
- `APPOINTMENTS_ADMIN_KEY`
- `STRIPE_SECRET_KEY`

## Supabase Tables

Run the SQL below in the Supabase SQL editor:

```sql
create table if not exists appointment_settings (
  id int primary key default 1,
  booking_enabled boolean not null default false,
  price_cents integer not null default 0,
  currency text not null default 'KES',
  available_days text[] not null default '{}',
  time_slots jsonb not null default '{}'::jsonb,
  timezone text not null default 'UTC',
  updated_at timestamptz default now()
);

insert into appointment_settings (id) values (1)
on conflict (id) do nothing;

create table if not exists appointment_blackouts (
  id bigint generated by default as identity primary key,
  date date not null unique
);

create table if not exists appointment_bookings (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  email text not null,
  purpose text not null,
  date date not null,
  time text not null,
  status text not null default 'pending',
  amount_cents integer not null,
  currency text not null default 'KES',
  hold_expires_at timestamptz,
  paid_at timestamptz,
  stripe_session_id text,
  stripe_payment_intent_id text,
  created_at timestamptz default now()
);
```

> The booking APIs use the service role key, so RLS is not required for these tables.
